<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8"/>
    <link rel="stylesheet" type="text/css" href="../../../css/page/payment/tosssuccess.css"/>
    <link rel="icon" href="https://static.toss.im/icons/png/4x/icon-toss-logo.png"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>책봄 결제 성공!</title>
</head>

<body>
<div class="wrapper w-100">
    <div class="box_section">
        <div class="flex-column align-center">
            <img src="https://static.toss.im/lotties/loading-spot-apng.png" width="120" height="120"></img>
            <h2 class="title text-center">결제 요청까지 성공했어요.</h2>
            <h4 class="text-center description">결제 승인하고 완료해보세요.</h4>
        </div>
        <div class="w-100">
            <button id="confirmPaymentButton" onclick="confirmPayment()">결제 승인하기</button>
        </div>
        <input id="order-id" type="text" style="display: none" th:value="${orderId}">
        <input id="payment-key" type="text" style="display: none" th:value="${paymentKey}">
        <input id="amount" type="text" style="display: none" th:value="${amount}">
    </div>
    </div>
</div>
<script>

    function confirmPayment() {
        const form = document.createElement('form');
        form.method = 'post';
        form.action = '/payment-complete';

        const orderId = document.getElementById("order-id").value;
        const paymentKey = document.getElementById("payment-key").value;
        const amount = document.getElementById("amount").value;

        const orderIdInput = document.createElement('input');
        orderIdInput.type = 'hidden';
        orderIdInput.name = "orderId";
        orderIdInput.value = orderId;
        form.appendChild(orderIdInput);

        const paymentKeyInput = document.createElement('input');
        paymentKeyInput.type = 'hidden';
        paymentKeyInput.name = "paymentKey";
        paymentKeyInput.value = paymentKey;
        form.appendChild(paymentKeyInput);

        const amountInput = document.createElement('input');
        amountInput.type = 'hidden';
        amountInput.name = "amount";
        amountInput.value = amount;
        form.appendChild(amountInput);



        document.body.appendChild(form);
        form.submit();
    }

    // function confirmPayment(){
    //     return new Promise((resolve, reject) => {
    //             const orderId = document.getElementById("order-id").value;
    //             const paymentKey = document.getElementById("payment-key").value;
    //             const amount = document.getElementById("amount").value;
    //             fetch('https://api.tosspayments.com/v1/payments/confirm', {
    //                 method: 'POST',
    //                 headers: {
    //                     'Content-Type': 'application/json'
    //                 },
    //                 body: JSON.stringify({
    //                     orderId: orderId,
    //                     paymentKey: paymentKey,
    //                     amount: amount
    //                 })
    //             })
    //                 .then(response => {
    //                     if (!response.ok) {
    //                         throw new Error('Network response was not ok');
    //                     }
    //                     return response.json();
    //                 })
    //                 .then(data => {
    //                     console.log('응답 받은 데이터:', data);
    //                     resolve(data); // 성공적으로 처리된 경우 Promise를 이행하고 데이터를 전달
    //                 })
    //                 .catch(error => {
    //                     console.error('오류 발생:', error);
    //                     reject(error); // 오류 발생 시 Promise를 거부하고 오류를 전달
    //                 });
    //         });
    //
    // }
    //
    // confirmPayment()
    //     .then(data => {
    //         // 성공적으로 처리된 경우
    //         alert('결제가 완료되었습니다!');
    //     })
    //     .catch(error => {
    //         // 오류가 발생한 경우
    //         alert('결제 처리 중 오류가 발생했습니다.');
    //     });
</script>
</body>
</html>
